<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE nta PUBLIC '-//Uppaal Team//DTD Flat System 1.1//EN' 'http://www.it.uu.se/research/group/darts/uppaal/flat-1_2.dtd'>
<nta>
	<declaration>// Place global declarations here.
chan gobag;
clock systemclock;
chan checkIn1, checkIn2, B_forward, B_stop, A_forward, A_stop, C_forward, C_reverseDirection, S1_activate, S1_passivate, S2_activate, S2_passivate, senseValue1, senseValue2;
broadcast chan sensorA1, sensorA2;

urgent broadcast chan go;

bool stop1, stop2;
int S1_val, S2_val;

int randuum(int min, int max) { return random(max-min)+min; }</declaration>
	<template>
		<name>PhysicalModel</name>
		<parameter>bool black</parameter>
		<declaration>clock x;
bool fwd;

int senseValue(int clockValue) {
    if (clockValue &lt;= 2 || clockValue &gt;= 14) { return randuum(71, 80); }
    else if (black) { return randuum(35, 45); }
    else            { return randuum(50, 60); }
}</declaration>
		<location id="id0" x="-408" y="-204">
		</location>
		<location id="id1" x="-340" y="-306">
			<name x="-357" y="-357">Stopping2</name>
			<label kind="invariant" x="-357" y="-340">x&lt;=14</label>
		</location>
		<location id="id2" x="-408" y="-306">
			<name x="-450" y="-357">Stopping1</name>
			<label kind="invariant" x="-433" y="-340">x&lt;=14</label>
		</location>
		<location id="id3" x="-340" y="-204">
			<name x="-357" y="-187">Stop2</name>
		</location>
		<location id="id4" x="-102" y="0">
			<committed/>
		</location>
		<location id="id5" x="-646" y="0">
			<committed/>
		</location>
		<location id="id6" x="-510" y="-68">
			<committed/>
		</location>
		<location id="id7" x="-374" y="0">
			<committed/>
		</location>
		<location id="id8" x="-238" y="-68">
			<committed/>
		</location>
		<location id="id9" x="-374" y="-510">
			<name x="-391" y="-544">Initial</name>
		</location>
		<location id="id10" x="0" y="0">
			<name x="-42" y="-51">Destination_B</name>
		</location>
		<location id="id11" x="-238" y="-136">
			<committed/>
		</location>
		<location id="id12" x="-510" y="-136">
			<committed/>
		</location>
		<location id="id13" x="-748" y="0">
			<name x="-790" y="-51">Destination_A</name>
		</location>
		<location id="id14" x="-238" y="-408">
			<name x="-195" y="-425">A2</name>
			<label kind="invariant" x="-204" y="-408">x&lt;=16</label>
		</location>
		<location id="id15" x="-510" y="-408">
			<name x="-569" y="-425">A1</name>
			<label kind="invariant" x="-578" y="-408">x&lt;=16</label>
		</location>
		<location id="id16" x="-238" y="0">
			<name x="-246" y="17">D2</name>
			<label kind="invariant" x="-255" y="34">x&lt;=24</label>
		</location>
		<location id="id17" x="-510" y="0">
			<name x="-518" y="17">D1</name>
			<label kind="invariant" x="-527" y="34">x&lt;=24</label>
		</location>
		<location id="id18" x="-646" y="-68">
			<name x="-654" y="17">E1</name>
			<label kind="invariant" x="-663" y="34">x&lt;=12</label>
		</location>
		<location id="id19" x="-102" y="-68">
			<name x="-110" y="17">E2</name>
			<label kind="invariant" x="-119" y="34">x&lt;=12</label>
		</location>
		<location id="id20" x="-238" y="-204">
			<name x="-195" y="-221">C2</name>
			<label kind="invariant" x="-204" y="-204">x&lt;=28</label>
		</location>
		<location id="id21" x="-510" y="-204">
			<name x="-569" y="-221">C1</name>
			<label kind="invariant" x="-578" y="-204">x&lt;=28</label>
		</location>
		<location id="id22" x="-374" y="-68">
			<name x="-382" y="17">F</name>
			<label kind="invariant" x="-391" y="34">x&lt;=33</label>
		</location>
		<location id="id23" x="-238" y="-306">
			<name x="-195" y="-323">B2</name>
			<label kind="invariant" x="-204" y="-306">x&lt;=24</label>
		</location>
		<location id="id24" x="-510" y="-306">
			<name x="-569" y="-323">B1</name>
			<label kind="invariant" x="-578" y="-306">x &lt;=24</label>
		</location>
		<init ref="id9"/>
		<transition>
			<source ref="id0"/>
			<target ref="id24"/>
			<label kind="guard" x="-476" y="-229">!stop1</label>
			<label kind="synchronisation" x="-484" y="-255">go!</label>
			<label kind="assignment" x="-476" y="-212">x:=14</label>
		</transition>
		<transition>
			<source ref="id24"/>
			<target ref="id2"/>
			<label kind="guard" x="-484" y="-340">stop1</label>
			<label kind="synchronisation" x="-484" y="-323">go!</label>
		</transition>
		<transition>
			<source ref="id2"/>
			<target ref="id0"/>
			<label kind="guard" x="-459" y="-280">x==14</label>
		</transition>
		<transition>
			<source ref="id1"/>
			<target ref="id3"/>
			<label kind="guard" x="-331" y="-280">x==14</label>
		</transition>
		<transition>
			<source ref="id13"/>
			<target ref="id13"/>
			<nail x="-816" y="-34"/>
			<nail x="-816" y="34"/>
		</transition>
		<transition>
			<source ref="id10"/>
			<target ref="id10"/>
			<nail x="68" y="-34"/>
			<nail x="68" y="34"/>
		</transition>
		<transition>
			<source ref="id3"/>
			<target ref="id23"/>
			<label kind="guard" x="-314" y="-229">!stop2</label>
			<label kind="synchronisation" x="-289" y="-255">go!</label>
			<label kind="assignment" x="-314" y="-212">x:=14</label>
			<nail x="-280" y="-263"/>
		</transition>
		<transition>
			<source ref="id23"/>
			<target ref="id1"/>
			<label kind="guard" x="-297" y="-340">stop2</label>
			<label kind="synchronisation" x="-297" y="-323">go!</label>
			<nail x="-289" y="-306"/>
		</transition>
		<transition>
			<source ref="id15"/>
			<target ref="id15"/>
			<label kind="synchronisation" x="-484" y="-493">senseValue1?</label>
			<label kind="assignment" x="-484" y="-476">S1_val:=
senseValue(x)</label>
			<nail x="-442" y="-374"/>
			<nail x="-442" y="-442"/>
		</transition>
		<transition>
			<source ref="id14"/>
			<target ref="id14"/>
			<label kind="synchronisation" x="-340" y="-493">senseValue2?</label>
			<label kind="assignment" x="-340" y="-476">S2_val:=
senseValue(x)</label>
			<nail x="-306" y="-374"/>
			<nail x="-306" y="-442"/>
		</transition>
		<transition>
			<source ref="id5"/>
			<target ref="id13"/>
			<label kind="guard" x="-705" y="-25">fwd</label>
		</transition>
		<transition>
			<source ref="id4"/>
			<target ref="id10"/>
			<label kind="guard" x="-68" y="-25">!fwd</label>
		</transition>
		<transition>
			<source ref="id4"/>
			<target ref="id16"/>
			<label kind="guard" x="-178" y="-25">fwd</label>
		</transition>
		<transition>
			<source ref="id19"/>
			<target ref="id4"/>
			<label kind="guard" x="-119" y="51">x&gt;=10</label>
			<label kind="assignment" x="-119" y="68">x:=0</label>
		</transition>
		<transition>
			<source ref="id5"/>
			<target ref="id17"/>
			<label kind="guard" x="-595" y="-25">!fwd</label>
		</transition>
		<transition>
			<source ref="id7"/>
			<target ref="id16"/>
			<label kind="guard" x="-314" y="-25">!fwd</label>
		</transition>
		<transition>
			<source ref="id7"/>
			<target ref="id17"/>
			<label kind="guard" x="-450" y="-25">fwd</label>
		</transition>
		<transition>
			<source ref="id8"/>
			<target ref="id19"/>
			<label kind="guard" x="-178" y="-68">!fwd</label>
		</transition>
		<transition>
			<source ref="id8"/>
			<target ref="id22"/>
			<label kind="guard" x="-314" y="-59">fwd</label>
		</transition>
		<transition>
			<source ref="id6"/>
			<target ref="id18"/>
			<label kind="guard" x="-595" y="-59">fwd</label>
		</transition>
		<transition>
			<source ref="id6"/>
			<target ref="id22"/>
			<label kind="guard" x="-450" y="-68">!fwd</label>
		</transition>
		<transition>
			<source ref="id18"/>
			<target ref="id5"/>
			<label kind="guard" x="-663" y="51">x&gt;=10</label>
			<label kind="assignment" x="-663" y="68">x:=0</label>
		</transition>
		<transition>
			<source ref="id17"/>
			<target ref="id6"/>
			<label kind="guard" x="-527" y="51">x&gt;=23</label>
			<label kind="assignment" x="-527" y="68">x:=0</label>
		</transition>
		<transition>
			<source ref="id22"/>
			<target ref="id7"/>
			<label kind="guard" x="-391" y="51">x&gt;=27</label>
			<label kind="assignment" x="-391" y="68">x:=0</label>
		</transition>
		<transition>
			<source ref="id16"/>
			<target ref="id8"/>
			<label kind="guard" x="-255" y="51">x&gt;=23</label>
			<label kind="assignment" x="-255" y="68">x:=0</label>
		</transition>
		<transition>
			<source ref="id9"/>
			<target ref="id14"/>
			<label kind="synchronisation" x="-314" y="-535">checkIn2?</label>
			<nail x="-238" y="-510"/>
		</transition>
		<transition>
			<source ref="id9"/>
			<target ref="id15"/>
			<label kind="synchronisation" x="-501" y="-535">checkIn1?</label>
			<nail x="-510" y="-510"/>
		</transition>
		<transition>
			<source ref="id20"/>
			<target ref="id11"/>
			<label kind="guard" x="-204" y="-187">x&gt;=24</label>
			<label kind="assignment" x="-204" y="-170">x:=0</label>
		</transition>
		<transition>
			<source ref="id21"/>
			<target ref="id12"/>
			<label kind="guard" x="-578" y="-187">x&gt;=24</label>
			<label kind="assignment" x="-578" y="-170">x:=0</label>
		</transition>
		<transition>
			<source ref="id14"/>
			<target ref="id23"/>
			<label kind="guard" x="-204" y="-391">x&gt;=16</label>
			<label kind="assignment" x="-204" y="-374">x:=0</label>
		</transition>
		<transition>
			<source ref="id15"/>
			<target ref="id24"/>
			<label kind="guard" x="-578" y="-391">x&gt;=16</label>
			<label kind="assignment" x="-578" y="-374">x:=0</label>
		</transition>
		<transition>
			<source ref="id12"/>
			<target ref="id18"/>
			<label kind="guard" x="-595" y="-110">fwd</label>
			<nail x="-510" y="-102"/>
		</transition>
		<transition>
			<source ref="id11"/>
			<target ref="id19"/>
			<label kind="guard" x="-178" y="-110">!fwd</label>
			<nail x="-238" y="-102"/>
		</transition>
		<transition>
			<source ref="id12"/>
			<target ref="id22"/>
			<label kind="guard" x="-450" y="-110">!fwd</label>
			<nail x="-510" y="-102"/>
		</transition>
		<transition>
			<source ref="id11"/>
			<target ref="id22"/>
			<label kind="guard" x="-314" y="-110">fwd</label>
			<nail x="-238" y="-102"/>
		</transition>
		<transition>
			<source ref="id23"/>
			<target ref="id20"/>
			<label kind="guard" x="-204" y="-289">x&gt;=24</label>
			<label kind="assignment" x="-204" y="-272">x:=0</label>
		</transition>
		<transition>
			<source ref="id24"/>
			<target ref="id21"/>
			<label kind="guard" x="-578" y="-289">x&gt;=24</label>
			<label kind="assignment" x="-578" y="-272">x:=0</label>
		</transition>
	</template>
	<template>
		<name>User</name>
		<declaration>clock x;</declaration>
		<location id="id25" x="238" y="0">
		</location>
		<location id="id26" x="119" y="-119">
			<name x="109" y="-153">S2Activated</name>
			<label kind="invariant" x="102" y="-102">x&lt;=4</label>
		</location>
		<location id="id27" x="0" y="0">
			<name x="-51" y="-34">Waiting</name>
		</location>
		<init ref="id27"/>
		<transition>
			<source ref="id25"/>
			<target ref="id27"/>
			<label kind="synchronisation" x="68" y="-25">S2_passivate?</label>
		</transition>
		<transition>
			<source ref="id26"/>
			<target ref="id25"/>
			<label kind="guard" x="204" y="-93">x==4</label>
			<label kind="synchronisation" x="204" y="-76">checkIn2!</label>
			<label kind="assignment" x="204" y="-59">x:=0</label>
		</transition>
		<transition>
			<source ref="id27"/>
			<target ref="id26"/>
			<label kind="synchronisation" x="-25" y="-85">S2_activate?</label>
			<label kind="assignment" x="17" y="-68">x:=0</label>
		</transition>
	</template>
	<template>
		<name>ControlModel</name>
		<declaration>clock y, z;

bool dirA, destA;
int done;
int[30,80] S1_value, S2_value;

bool isClear (int value) { return value &gt; 70; }
bool isYellow(int value) { return value &gt;= 50 &amp;&amp; value &lt;= 60; }
bool isBlack (int value) { return value &gt;= 35 &amp;&amp; value &lt;= 45; }</declaration>
		<location id="id28" x="-544" y="306">
			<committed/>
		</location>
		<location id="id29" x="170" y="170">
		</location>
		<location id="id30" x="170" y="34">
		</location>
		<location id="id31" x="0" y="-102">
		</location>
		<location id="id32" x="-204" y="34">
			<name x="-187" y="8">Follow_End_Feed_Belt</name>
			<label kind="invariant" x="-195" y="-59">y&lt;=12</label>
		</location>
		<location id="id33" x="-204" y="171">
			<committed/>
		</location>
		<location id="id34" x="-340" y="306">
			<committed/>
		</location>
		<location id="id35" x="-340" y="476">
			<label kind="invariant" x="-476" y="484">z&lt;=120</label>
		</location>
		<location id="id36" x="-204" y="476">
			<committed/>
		</location>
		<location id="id37" x="-204" y="306">
			<committed/>
		</location>
		<location id="id38" x="-476" y="-102">
			<committed/>
		</location>
		<location id="id39" x="-340" y="-102">
			<committed/>
		</location>
		<location id="id40" x="0" y="306">
			<committed/>
		</location>
		<location id="id41" x="170" y="306">
			<name x="204" y="280">Advance_Beyond_Sensor</name>
			<label kind="invariant" x="76" y="314">y&lt;=20</label>
		</location>
		<location id="id42" x="170" y="-102">
			<name x="204" y="-136">Awaiting_Valid_Color</name>
			<label kind="invariant" x="204" y="-77">y &lt;= 8</label>
		</location>
		<location id="id43" x="-204" y="-102">
			<name x="-195" y="-136">Awaiting_Bag</name>
		</location>
		<init ref="id38"/>
		<transition>
			<source ref="id33"/>
			<target ref="id32"/>
			<label kind="guard" x="-119" y="86">!dirA</label>
			<label kind="assignment" x="-119" y="103">z:=60</label>
			<nail x="-136" y="103"/>
		</transition>
		<transition>
			<source ref="id35"/>
			<target ref="id28"/>
			<label kind="guard" x="-476" y="501">z&gt;=120</label>
			<label kind="assignment" x="-476" y="518">z:=0</label>
			<nail x="-544" y="476"/>
		</transition>
		<transition>
			<source ref="id29"/>
			<target ref="id41"/>
			<label kind="synchronisation" x="204" y="204">S2_passivate!</label>
			<label kind="assignment" x="204" y="221">destA:=isBlack(S2_val)</label>
		</transition>
		<transition>
			<source ref="id30"/>
			<target ref="id29"/>
			<label kind="synchronisation" x="204" y="68">senseValue2!</label>
		</transition>
		<transition>
			<source ref="id43"/>
			<target ref="id31"/>
			<label kind="synchronisation" x="-144" y="-102">S2_activate!</label>
		</transition>
		<transition>
			<source ref="id32"/>
			<target ref="id43"/>
			<label kind="guard" x="-195" y="-41">y==12</label>
			<label kind="assignment" x="-195" y="-25">y:=0</label>
		</transition>
		<transition>
			<source ref="id33"/>
			<target ref="id32"/>
			<label kind="guard" x="-314" y="85">dirA</label>
			<label kind="assignment" x="-314" y="102">z:=0</label>
			<nail x="-272" y="103"/>
		</transition>
		<transition>
			<source ref="id37"/>
			<target ref="id33"/>
		</transition>
		<transition>
			<source ref="id34"/>
			<target ref="id37"/>
			<label kind="synchronisation" x="-306" y="306">B_forward!</label>
		</transition>
		<transition>
			<source ref="id28"/>
			<target ref="id34"/>
			<label kind="synchronisation" x="-510" y="306">C_reverseDirection!</label>
			<label kind="assignment" x="-484" y="323">dirA:=destA</label>
		</transition>
		<transition>
			<source ref="id36"/>
			<target ref="id35"/>
			<label kind="synchronisation" x="-289" y="476">B_stop!</label>
		</transition>
		<transition>
			<source ref="id40"/>
			<target ref="id36"/>
			<label kind="guard" x="-136" y="450">dirA !=destA</label>
			<nail x="0" y="476"/>
		</transition>
		<transition>
			<source ref="id40"/>
			<target ref="id37"/>
			<label kind="guard" x="-144" y="280">dirA == destA</label>
		</transition>
		<transition>
			<source ref="id38"/>
			<target ref="id39"/>
			<label kind="synchronisation" x="-442" y="-102">B_forward!</label>
			<label kind="assignment" x="-425" y="-85">z:=120</label>
		</transition>
		<transition>
			<source ref="id39"/>
			<target ref="id43"/>
			<label kind="synchronisation" x="-306" y="-102">C_forward!</label>
			<label kind="assignment" x="-306" y="-85">dirA:=true</label>
		</transition>
		<transition>
			<source ref="id41"/>
			<target ref="id40"/>
			<label kind="guard" x="76" y="331">y==20</label>
			<label kind="assignment" x="76" y="348">y:=0</label>
		</transition>
		<transition>
			<source ref="id42"/>
			<target ref="id30"/>
			<label kind="guard" x="204" y="-59">y==8</label>
			<label kind="assignment" x="204" y="-42">y:=0</label>
		</transition>
		<transition>
			<source ref="id31"/>
			<target ref="id42"/>
			<label kind="guard" x="42" y="-153">!isClear(S2_value)</label>
			<label kind="synchronisation" x="42" y="-170">go!</label>
		</transition>
	</template>
	<template>
		<name>Band1</name>
		<location id="id44" x="238" y="0">
			<name x="238" y="-34">Stop</name>
		</location>
		<location id="id45" x="0" y="0">
			<name x="-59" y="-34">Forward</name>
		</location>
		<init ref="id45"/>
		<transition>
			<source ref="id44"/>
			<target ref="id45"/>
			<label kind="synchronisation" x="60" y="51">A_stop?</label>
			<nail x="178" y="68"/>
			<nail x="42" y="68"/>
		</transition>
		<transition>
			<source ref="id45"/>
			<target ref="id44"/>
			<label kind="synchronisation" x="69" y="-76">A_forward?</label>
			<nail x="51" y="-59"/>
			<nail x="195" y="-59"/>
		</transition>
	</template>
	<template>
		<name>Band2</name>
		<location id="id46" x="68" y="-17">
			<name x="76" y="-51">Stop</name>
		</location>
		<location id="id47" x="-127" y="-17">
			<name x="-195" y="-51">Forward</name>
		</location>
		<init ref="id47"/>
		<transition>
			<source ref="id46"/>
			<target ref="id47"/>
			<label kind="synchronisation" x="-92" y="17">B_forward?</label>
			<nail x="51" y="34"/>
			<nail x="-110" y="34"/>
		</transition>
		<transition>
			<source ref="id47"/>
			<target ref="id46"/>
			<label kind="synchronisation" x="-84" y="-93">B_stop?</label>
			<nail x="-102" y="-76"/>
			<nail x="51" y="-76"/>
		</transition>
	</template>
	<template>
		<name>DistributionBand</name>
		<location id="id48" x="51" y="-17">
			<name x="76" y="-51">Backward</name>
		</location>
		<location id="id49" x="-153" y="-17">
			<name x="-213" y="-51">Forward</name>
		</location>
		<init ref="id49"/>
		<transition>
			<source ref="id49"/>
			<target ref="id49"/>
			<label kind="synchronisation" x="-323" y="-25">C_forward?</label>
			<nail x="-238" y="-34"/>
			<nail x="-238" y="0"/>
		</transition>
		<transition>
			<source ref="id48"/>
			<target ref="id49"/>
			<label kind="synchronisation" x="-109" y="8">C_reverseDirection?</label>
			<nail x="17" y="25"/>
			<nail x="-127" y="25"/>
		</transition>
		<transition>
			<source ref="id49"/>
			<target ref="id48"/>
			<label kind="synchronisation" x="-119" y="-76">C_reverseDirection?</label>
			<nail x="-127" y="-51"/>
			<nail x="17" y="-51"/>
		</transition>
	</template>
	<system>// Place template instantiations here.
Bag = PhysicalModel(true);
// List one or more processes to be composed into a system.
system Bag, User;
    </system>
	<queries>
	</queries>
</nta>
